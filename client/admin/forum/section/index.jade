//- Helper to render single section control bar with children list.
mixin render_sections_tree(sections, level)
  ul.aforum-index__slist
    each section in sections
      - var moderators = section.own_moderator_list.filter(function(id) { return self.users[id] });
      li.aforum-index__slist-item(data-id=section._id)
        //- Section's own control bar.
        .aforum-index__section
          .pull-xs-right
            span.aforum-index__section-mods.dropdown
              button.dropdown-toggle.btn.btn-link.btn-sm(
                type='button'
                data-toggle='dropdown'
              )
                = self.t('moderators_info', { count: moderators.length })

              .dropdown-menu.dropdown-menu-right
                each moderator_id in moderators
                  a.dropdown-item(
                    href=self.link_to('admin.forum.moderator.edit', { section_id: section._id, user_id: moderator_id })
                  )
                    = self.users[moderator_id].name

                if 0 !== moderators.length
                  .dropdown-divider

                button.dropdown-item(
                  type='button'
                  data-on-click='admin.forum.section.select_moderator_nick'
                  data-section_id=section._id
                )
                  = self.t('add_moderator')

            a.aforum-index__section-delete.btn.btn-link.btn-sm(
              href="#",
              data-on-click="admin.forum.section.destroy",
              data-id=section._id,
              data-title=section.title
            ) #{self.t('delete_section')}

          .aforum-index__section-info
            i.aforum-index__sorter.icon.icon-sorter._sorter

            a.aforum-index__section-title(href=self.link_to('admin.forum.section.edit', { _id: section._id }))
              = section.title

        //- Section's children list.
        mixin render_sections_tree(section.children, level + 1)

#content
  != self.partial('@admin.core.blocks.sidebar_menu')

  .main
    != self.partial('@admin.core.blocks.breadcrumbs')

    h1
      .pull-xs-right: a.btn.btn-primary(href=self.link_to('admin.forum.section.new')) #{self.t('new_section')}

      | #{self.head.title}

    .aforum-index__scontent._container
      mixin render_sections_tree(self.sections, 0)
